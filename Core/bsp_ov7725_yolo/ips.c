#include "ips.h"
#include "spi.h"
#include "ips_gui.h"

#define IPS_SPI hspi1

/************************************5*8************************************/
const unsigned char F6x8[][6] =		
{
0x00, 0x00, 0x00, 0x00, 0x00, 0x00,// sp
0x00, 0x00, 0x00, 0x2f, 0x00, 0x00,// !
0x00, 0x00, 0x07, 0x00, 0x07, 0x00,// "
0x00, 0x14, 0x7f, 0x14, 0x7f, 0x14,// #
0x00, 0x24, 0x2a, 0x7f, 0x2a, 0x12,// $
0x00, 0x62, 0x64, 0x08, 0x13, 0x23,// %
0x00, 0x36, 0x49, 0x55, 0x22, 0x50,// &
0x00, 0x00, 0x05, 0x03, 0x00, 0x00,// '
0x00, 0x00, 0x1c, 0x22, 0x41, 0x00,// (
0x00, 0x00, 0x41, 0x22, 0x1c, 0x00,// )
0x00, 0x14, 0x08, 0x3E, 0x08, 0x14,// *
0x00, 0x08, 0x08, 0x3E, 0x08, 0x08,// +
0x00, 0x00, 0x00, 0xA0, 0x60, 0x00,// ,
0x00, 0x08, 0x08, 0x08, 0x08, 0x08,// -
0x00, 0x00, 0x60, 0x60, 0x00, 0x00,// .
0x00, 0x20, 0x10, 0x08, 0x04, 0x02,// /
0x00, 0x3E, 0x51, 0x49, 0x45, 0x3E,// 0
0x00, 0x00, 0x42, 0x7F, 0x40, 0x00,// 1
0x00, 0x42, 0x61, 0x51, 0x49, 0x46,// 2
0x00, 0x21, 0x41, 0x45, 0x4B, 0x31,// 3
0x00, 0x18, 0x14, 0x12, 0x7F, 0x10,// 4
0x00, 0x27, 0x45, 0x45, 0x45, 0x39,// 5
0x00, 0x3C, 0x4A, 0x49, 0x49, 0x30,// 6
0x00, 0x01, 0x71, 0x09, 0x05, 0x03,// 7
0x00, 0x36, 0x49, 0x49, 0x49, 0x36,// 8
0x00, 0x06, 0x49, 0x49, 0x29, 0x1E,// 9
0x00, 0x00, 0x36, 0x36, 0x00, 0x00,// :
0x00, 0x00, 0x56, 0x36, 0x00, 0x00,// ;
0x00, 0x08, 0x14, 0x22, 0x41, 0x00,// <
0x00, 0x14, 0x14, 0x14, 0x14, 0x14,// =
0x00, 0x00, 0x41, 0x22, 0x14, 0x08,// >
0x00, 0x02, 0x01, 0x51, 0x09, 0x06,// ?
0x00, 0x32, 0x49, 0x59, 0x51, 0x3E,// @
0x00, 0x7C, 0x12, 0x11, 0x12, 0x7C,// A
0x00, 0x7F, 0x49, 0x49, 0x49, 0x36,// B
0x00, 0x3E, 0x41, 0x41, 0x41, 0x22,// C
0x00, 0x7F, 0x41, 0x41, 0x22, 0x1C,// D
0x00, 0x7F, 0x49, 0x49, 0x49, 0x41,// E
0x00, 0x7F, 0x09, 0x09, 0x09, 0x01,// F
0x00, 0x3E, 0x41, 0x49, 0x49, 0x7A,// G
0x00, 0x7F, 0x08, 0x08, 0x08, 0x7F,// H
0x00, 0x00, 0x41, 0x7F, 0x41, 0x00,// I
0x00, 0x20, 0x40, 0x41, 0x3F, 0x01,// J
0x00, 0x7F, 0x08, 0x14, 0x22, 0x41,// K
0x00, 0x7F, 0x40, 0x40, 0x40, 0x40,// L
0x00, 0x7F, 0x02, 0x0C, 0x02, 0x7F,// M
0x00, 0x7F, 0x04, 0x08, 0x10, 0x7F,// N
0x00, 0x3E, 0x41, 0x41, 0x41, 0x3E,// O
0x00, 0x7F, 0x09, 0x09, 0x09, 0x06,// P
0x00, 0x3E, 0x41, 0x51, 0x21, 0x5E,// Q
0x00, 0x7F, 0x09, 0x19, 0x29, 0x46,// R
0x00, 0x46, 0x49, 0x49, 0x49, 0x31,// S
0x00, 0x01, 0x01, 0x7F, 0x01, 0x01,// T
0x00, 0x3F, 0x40, 0x40, 0x40, 0x3F,// U
0x00, 0x1F, 0x20, 0x40, 0x20, 0x1F,// V
0x00, 0x3F, 0x40, 0x38, 0x40, 0x3F,// W
0x00, 0x63, 0x14, 0x08, 0x14, 0x63,// X
0x00, 0x07, 0x08, 0x70, 0x08, 0x07,// Y
0x00, 0x61, 0x51, 0x49, 0x45, 0x43,// Z
0x00, 0x00, 0x7F, 0x41, 0x41, 0x00,// [
0x00, 0x55, 0x2A, 0x55, 0x2A, 0x55,// 55
0x00, 0x00, 0x41, 0x41, 0x7F, 0x00,// ]
0x00, 0x04, 0x02, 0x01, 0x02, 0x04,// ^
0x00, 0x40, 0x40, 0x40, 0x40, 0x40,// _
0x00, 0x00, 0x01, 0x02, 0x04, 0x00,// '
0x00, 0x20, 0x54, 0x54, 0x54, 0x78,// a
0x00, 0x7F, 0x48, 0x44, 0x44, 0x38,// b
0x00, 0x38, 0x44, 0x44, 0x44, 0x20,// c
0x00, 0x38, 0x44, 0x44, 0x48, 0x7F,// d
0x00, 0x38, 0x54, 0x54, 0x54, 0x18,// e
0x00, 0x08, 0x7E, 0x09, 0x01, 0x02,// f
0x00, 0x18, 0xA4, 0xA4, 0xA4, 0x7C,// g
0x00, 0x7F, 0x08, 0x04, 0x04, 0x78,// h
0x00, 0x00, 0x44, 0x7D, 0x40, 0x00,// i
0x00, 0x40, 0x80, 0x84, 0x7D, 0x00,// j
0x00, 0x7F, 0x10, 0x28, 0x44, 0x00,// k
0x00, 0x00, 0x41, 0x7F, 0x40, 0x00,// l
0x00, 0x7C, 0x04, 0x18, 0x04, 0x78,// m
0x00, 0x7C, 0x08, 0x04, 0x04, 0x78,// n
0x00, 0x38, 0x44, 0x44, 0x44, 0x38,// o
0x00, 0xFC, 0x24, 0x24, 0x24, 0x18,// p
0x00, 0x18, 0x24, 0x24, 0x18, 0xFC,// q
0x00, 0x7C, 0x08, 0x04, 0x04, 0x08,// r
0x00, 0x48, 0x54, 0x54, 0x54, 0x20,// s
0x00, 0x04, 0x3F, 0x44, 0x40, 0x20,// t
0x00, 0x3C, 0x40, 0x40, 0x20, 0x7C,// u
0x00, 0x1C, 0x20, 0x40, 0x20, 0x1C,// v
0x00, 0x3C, 0x40, 0x30, 0x40, 0x3C,// w
0x00, 0x44, 0x28, 0x10, 0x28, 0x44,// x
0x00, 0x1C, 0xA0, 0xA0, 0xA0, 0x7C,// y
0x00, 0x44, 0x64, 0x54, 0x4C, 0x44,// z
0x14, 0x14, 0x14, 0x14, 0x14, 0x14,// horiz lines
};

void LCD_Reset(void)
{
	HAL_GPIO_WritePin(RES_GPIO, RES_PIN, GPIO_PIN_RESET);
	HAL_Delay(20);
	HAL_GPIO_WritePin(RES_GPIO, RES_PIN, GPIO_PIN_SET);
	HAL_Delay(20);
}

void LCD_WriteData_Byte(uint8_t da) 
{	
	HAL_GPIO_WritePin(DC_GPIO, DC_PIN, GPIO_PIN_SET);
	HAL_SPI_Transmit(&IPS_SPI, (uint8_t *)&da, 1, 500);
}

 void LCD_WriteData_Word(uint16_t da)
{
	uint8_t i=(da>>8)&0xff;	//¸ß°ËÎ»
	HAL_GPIO_WritePin(DC_GPIO, DC_PIN, GPIO_PIN_SET);
	HAL_SPI_Transmit(&IPS_SPI, (uint8_t *)&i, 1, 500);
	HAL_SPI_Transmit(&IPS_SPI, (uint8_t *)&da, 1, 500);
}	

void LCD_WriteReg(uint8_t da)	 
{	
	HAL_GPIO_WritePin(DC_GPIO, DC_PIN, GPIO_PIN_RESET);
	HAL_SPI_Transmit(&IPS_SPI, (uint8_t *)&da, 1, 500);
}

void LCD_DrawPoint(uint16_t x, uint16_t y, uint16_t color)
{
	LCD_SetCursor(x,y,x,y);
	LCD_WriteData_Word(color);
}

void LCD_ShowChar(uint16_t x, uint16_t y, uint8_t ch, uint16_t color)
{
	uint8_t i,j,font_data;
	ch = ch-' ';
	for(i=0;i<6;i++)
	{
		font_data = F6x8[ch][i];
		for(j=0;j<8;j++)
		{
			if((font_data&(1<<j)) != 0)
				//LCD_DrawPoint(x,y,color);
				GUI_DrawPoint(x,y,color);
			else
				//LCD_DrawPoint(x,y,WHITE);
				GUI_DrawPoint(x,y,WHITE);
			y++;
		}
		x++;
		y-=8;
	}
}

void LCD_ShowString(uint16_t x, uint16_t y, uint8_t * ch, uint16_t color)
{
	uint8_t i = 0;
	while(ch[i] != '\0')
	{
		LCD_ShowChar(x,y,ch[i],color);
		x+=6;
		i++;
	}
}

void LCD_Init(void)
{
	LCD_Reset();

	//************* Start Initial Sequence **********// 
	LCD_WriteReg(0x11);//Sleep exit 
	HAL_Delay (120);
  LCD_WriteReg(0x21); 
  LCD_WriteReg(0x21); 

  LCD_WriteReg(0xB1); 
  LCD_WriteData_Byte(0x05);
  LCD_WriteData_Byte(0x3A);
  LCD_WriteData_Byte(0x3A);

  LCD_WriteReg(0xB2);
  LCD_WriteData_Byte(0x05);
  LCD_WriteData_Byte(0x3A);
  LCD_WriteData_Byte(0x3A);

  LCD_WriteReg(0xB3); 
  LCD_WriteData_Byte(0x05);  
  LCD_WriteData_Byte(0x3A);
  LCD_WriteData_Byte(0x3A);
  LCD_WriteData_Byte(0x05);
  LCD_WriteData_Byte(0x3A);
  LCD_WriteData_Byte(0x3A);

  LCD_WriteReg(0xB4);
  LCD_WriteData_Byte(0x03);

  LCD_WriteReg(0xC0);
  LCD_WriteData_Byte(0x62);
  LCD_WriteData_Byte(0x02);
  LCD_WriteData_Byte(0x04);

  LCD_WriteReg(0xC1);
  LCD_WriteData_Byte(0xC0);

  LCD_WriteReg(0xC2);
  LCD_WriteData_Byte(0x0D);
  LCD_WriteData_Byte(0x00);

  LCD_WriteReg(0xC3);
  LCD_WriteData_Byte(0x8D);
  LCD_WriteData_Byte(0x6A);   

  LCD_WriteReg(0xC4);
  LCD_WriteData_Byte(0x8D); 
  LCD_WriteData_Byte(0xEE); 

  LCD_WriteReg(0xC5);  /*VCOM*/
  LCD_WriteData_Byte(0x0E);    

  LCD_WriteReg(0xE0);
  LCD_WriteData_Byte(0x10);
  LCD_WriteData_Byte(0x0E);
  LCD_WriteData_Byte(0x02);
  LCD_WriteData_Byte(0x03);
  LCD_WriteData_Byte(0x0E);
  LCD_WriteData_Byte(0x07);
  LCD_WriteData_Byte(0x02);
  LCD_WriteData_Byte(0x07);
  LCD_WriteData_Byte(0x0A);
  LCD_WriteData_Byte(0x12);
  LCD_WriteData_Byte(0x27);
  LCD_WriteData_Byte(0x37);
  LCD_WriteData_Byte(0x00);
  LCD_WriteData_Byte(0x0D);
  LCD_WriteData_Byte(0x0E);
  LCD_WriteData_Byte(0x10);

  LCD_WriteReg(0xE1);
  LCD_WriteData_Byte(0x10);
  LCD_WriteData_Byte(0x0E);
  LCD_WriteData_Byte(0x03);
  LCD_WriteData_Byte(0x03);
  LCD_WriteData_Byte(0x0F);
  LCD_WriteData_Byte(0x06);
  LCD_WriteData_Byte(0x02);
  LCD_WriteData_Byte(0x08);
  LCD_WriteData_Byte(0x0A);
  LCD_WriteData_Byte(0x13);
  LCD_WriteData_Byte(0x26);
  LCD_WriteData_Byte(0x36);
  LCD_WriteData_Byte(0x00);
  LCD_WriteData_Byte(0x0D);
  LCD_WriteData_Byte(0x0E);
  LCD_WriteData_Byte(0x10);

  LCD_WriteReg(0x3A); 
  LCD_WriteData_Byte(0x05);

  LCD_WriteReg(0x36);
  LCD_WriteData_Byte(0xA8);//

  LCD_WriteReg(0x29); 
} 

/******************************************************************************
function:	Set the cursor position
parameter	:
		Xstart: 	Start UWORD x coordinate
	  Ystart:		Start UWORD y coordinate
	  Xend  :		End UWORD coordinates
	  Yend  :		End UWORD coordinatesen
******************************************************************************/
void LCD_SetCursor(uint16_t Xstart, uint16_t Ystart, uint16_t Xend, uint16_t  Yend)
{ 
	Xstart = Xstart+1;
	Xend = Xend+1;
	Ystart = Ystart+26;
	Yend = Yend+26;
	LCD_WriteReg(0x2a);
	LCD_WriteData_Byte(Xstart>>8);
	LCD_WriteData_Byte(Xstart);
	LCD_WriteData_Byte(Xend >>8);
	LCD_WriteData_Byte(Xend );

	LCD_WriteReg(0x2b);
	LCD_WriteData_Byte(Ystart>>8);
	LCD_WriteData_Byte(Ystart);
	LCD_WriteData_Byte(Yend>>8);
	LCD_WriteData_Byte(Yend);

	LCD_WriteReg(0x2C);
}

void LCD_Clear(uint16_t Color)
{
	uint16_t i,j;  	
	LCD_SetCursor(0,0,LCD_WIDTH-1,LCD_HEIGHT-1);
	for(i = 0; i < LCD_WIDTH; i++){
		for(j = 0; j < LCD_HEIGHT; j++){
			LCD_WriteData_Word(Color);
		}
	 }
}
